# **Calculator Server – Документация проекта**

## **Описание**
Этот проект представляет собой веб-сервер на Python, который выполняет вычисления, используя C-программу. Сервер обрабатывает HTTP-запросы и вычисляет переданные арифметические выражения, поддерживая как целочисленные, так и вещественные операции.

## **Функциональность**
- Принимает `POST`-запросы с арифметическим выражением в теле.
- Поддерживает два режима вычислений:
  - Целочисленный (по умолчанию).
  - Вещественный (`float=true` в query-параметре).
- Возвращает результат вычислений в формате JSON.
- В случае ошибки корректно обрабатывает исключения и возвращает `500 Internal Server Error`.
- Логирование запросов и результатов в:
  - Консоль (человекочитаемый формат).
  - Файл (JSON).

## **Установка и запуск**
1. Убедитесь, что у вас установлен `gcc` (или `clang`), а также `python3`.
2. Для сборки C-программы и установки зависимостей используйте:
   ```bash
   make
   ```
3. Для запуска сервера выполните:
   ```bash
   make run-server
   ```
4. Сервер будет запущен на `http://localhost:8000`.

## **Использование API**

### **1. Вычисление целочисленного выражения**
**Метод:** `POST`  
**URL:** `http://localhost:8000/calc`  
**Заголовки:**
- `Content-Type: application/json`

**Пример тела запроса:**
```json
"3 + 2"
```
**Ожидаемый ответ (200 OK):**
```json
"5"
```

### **2. Вычисление выражения в режиме `float`**
**Метод:** `POST`  
**URL:** `http://localhost:8000/calc?float=true`  
**Пример тела запроса:**
```json
"3 / 2"
```
**Ожидаемый ответ (200 OK):**
```json
"1.5"
```

### **3. Ошибка вычисления (некорректное выражение)**
**Метод:** `POST`  
**URL:** `http://localhost:8000/calc`  
**Пример тела запроса:**
```json
"1 ++ 2"
```
**Ожидаемый ответ (500 Internal Server Error):**
```json
{
  "error": "Calculation error"
}
```

## **Логирование**
- **Консоль:** Все запросы и ответы логируются в читаемом формате.
- **Файл (`build/server.log`)**: Хранит логи в формате JSON.

Пример содержимого `server.log`:
```json
{"event": "request_received", "path": "/calc", "query": "", "timestamp": "2025-03-12T19:15:00.123456"}
{"event": "calc_success", "output": "5", "timestamp": "2025-03-12T19:15:00.124345"}
```

## **Тестирование**
- Юнит-тесты для C-программы выполняются через:
  ```bash
  make run-unit-test
  ```
- Интеграционные тесты:
  ```bash
  make run-integration-tests
  ```
- Проверка сервера через `curl`:
  ```bash
  curl -X POST http://localhost:8000/calc -H "Content-Type: application/json" -d "\"3 + 2\""
  ```
